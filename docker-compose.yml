services:

  # ── Frontend ─────────────────────────────────────────────────────────────────
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # VITE_API_URL is baked into the bundle at build time by Vite.
        # To proxy through nginx (recommended): set to /api and uncomment the
        # nginx proxy block in nginx.conf.
        # To point directly at the backend container: use http://backend:3000
        VITE_API_URL: ${VITE_API_URL:-http://localhost:3000}
    ports:
      - "${FRONTEND_PORT:-80}:8080"
    healthcheck:
      test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://127.0.0.1:8080/healthz || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    restart: unless-stopped
    # depends_on:
    #   - backend

  # ── Backend ───────────────────────────────────────────────────────────────────
  # Uncomment when running e2e / manual integration tests with express-auth-app.
  # Expects the backend image to be built separately or available locally.
  #
  # backend:
  #   image: express-auth-app:latest
  #   # Or build from source if repos are sibling directories:
  #   # build:
  #   #   context: ../express-auth-app
  #   #   dockerfile: Dockerfile
  #   ports:
  #     - "3000:3000"
  #   environment:
  #     NODE_ENV:              production
  #     PORT:                  3000
  #     DATABASE_URL:          ${DATABASE_URL}
  #     JWT_SECRET:            ${JWT_SECRET}
  #     JWT_REFRESH_SECRET:    ${JWT_REFRESH_SECRET}
  #     CLIENT_URL:            http://localhost:${FRONTEND_PORT:-80}
  #   restart: unless-stopped

  # ── Future: Traefik gateway (Phase 2 — see AUTH_PLATFORM_ARCHITECTURE.md) ────
  #
  # traefik:
  #   image: traefik:v3.0
  #   command:
  #     - "--providers.docker=true"
  #     - "--entrypoints.web.address=:80"
  #   ports:
  #     - "80:80"
  #     - "8080:8080"   # Traefik dashboard
  #   volumes:
  #     - /var/run/docker.sock:/var/run/docker.sock:ro
